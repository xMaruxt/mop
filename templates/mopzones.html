<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>View MopZone Entries</title>
    <link rel="stylesheet" href="/templates/style.css">
</head>
<style>
    * {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  background-color: rgba(green, 0.1);
}

body {
  display: flex;
}

:root {
  --markas: #28c7e8;
  --green: #8fb317;
}

/* GENERAL -------------------------------------------------------------------------------- */


header.nav {
  width: 25vh;
  background-color: var(--markas);
  padding: 1rem;
  min-height: 100vh;
  display: flex;
  justify-content: space-between;
  flex-direction: column;
}
.nav ul {
  padding: 0 1rem;
  list-style: none;
}
header.nav ul li:first-child {
  display: flex;
  justify-content: center;
}
.nav ul li {
  margin-top: 1rem;
}
header.nav * {
  color: #fff;
}
header.nav .logo {
  display: block;
  width: 120px;
  height: auto;
}
/* Header -------------------------------------------------------------------------------- */

main {
  margin: 0 auto;
  padding: 2rem 0;
  max-height: 100vh;
  overflow: hidden;

  display: flex;
  flex-direction: column;
  gap: 1rem;
}

h1 {
  color: var(--markas);
}

.scans-ct {
  max-height: 80vh;
  overflow: scroll;
}

.scans-ct.whos-missing .row {
  display: none;
}
.scans-ct.whos-missing .row.not-me {
  display: flex;
}

.info,
.row {
  display: flex;
  align-items: center;
  margin: 0.5rem 0 0 0;
  border: 1px solid var(--markas);
}

.row {
  border-radius: 20px;
}

.row p,
.info p {
  padding: 1rem;
  min-width: 200px;
}

.row p:nth-child(2),
.info p:nth-child(2),
.row p:nth-child(4),
.info p:nth-child(4) {
  background-color: rgba(40,199,232, 0.1);
}


.row.green {background-color: rgba(143, 179, 23, 0.2);}


button {
  color: white;
  background-color: var(--green);
  border: none;
  padding: 1rem;
}

.hidden {
  visibility: hidden;
}
/* Main -------------------------------------------------------------------------------- */

.toggle-container {
  position: absolute;
  top: 3rem;
  right: 3rem;
  display: flex;
  align-items: center;
  gap: 1rem;
}

.toggle-switch {
  position: relative;
  width: 50px;
  height: 25px;
}

.toggle-switch input {
  display: none;
}

.slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #ccc;
  transition: 0.4s;
  border-radius: 25px;
}

.slider:before {
  position: absolute;
  content: "";
  height: 20px;
  width: 20px;
  left: 3px;
  bottom: 2.5px;
  background-color: white;
  transition: 0.4s;
  border-radius: 50%;
}

input:checked + .slider {
  background-color: var(--green);
}

input:checked + .slider:before {
  transform: translateX(24px);
}

#status {
  font-size: 1.2rem;
  color: #333;
}

/* TOGGLE ---------------------------------------------------------------------- */
</style>
<body>
  <header class="nav">
    <ul>
      <li><img src="/templates/logo.svg" alt="logoalt" width="50" height="50" class="logo"></li>
      <li>Dei bei grafici?</li>
      <li>Best employee</li>
      <li>Inventario</li>
      <li>Perdite</li>
    </ul>
    <ul>
      <li>Lorem</li>
      <li>ipsum</li>
      <li>dolor</li>
      <li>sit</li>
      <li>amet</li>
      <li>consectetur</li>
    </ul>
  </header>
  <main class="content">
    <div class="top">
      <h1>Your Dashboard</h1>
      <h2>MopZone Entries</h2>
      <div class="toggle-container">
        Lost items
        <label class="toggle-switch">
          <input type="checkbox" id="toggle">
          <span class="slider"></span>
        </label>
        <p id="status">OFF</p>
      </div>
    </div>
    <div class="scans-ct">
      <div class="info">
        <p>ID</p>
        <p>MOP ID</p>
        <p>ZONE ID</p>
        <p>ZONE ID</p>
      </div>
      <!-- Le righe delle entry verranno inserite qui -->
      {% for mopzone in mopzones %}
      <div class="row">
        <p>{{ mopzone.id }}</p>
        <p>{{ mopzone.idMop }}</p>
        <p>{{ mopzone.idZone }}</p>
        <p>{{ mapzone.date }}</p>
      </div>
      {% endfor %}
    </div>
  </main>

  <script>
      const main = document.querySelector('main.content .scans-ct');

// VARIABLES -------------------------------------------------------------------------------------------------------

const hospitalZones = {
  "1": "Reception",
  "2": "Emergency Room",
  "3": "Radiology",
  "4": "Pediatrics",
  "5": "Surgery",
  "6": "Cardiology",
  "7": "Dermatology",
  "8": "Neurology",
  "9": "Oncology"
};


data.forEach(item => {
  const routerZone = hospitalZones[item.router_id] || "Unknown Zone";
  item.clean_router_id = routerZone;
});


/*data.forEach(scan => {
  let row = document.createElement('div');
  row.classList.add('row');
  row.setAttribute('data-id', scan.mop_id);

  row.innerHTML = `
    <p>${scan.id}</p>
    <p>${scan.mop_id}</p>
    <p>(${scan.router_id}) ${scan.clean_router_id}</p>
    <p>${scan.scanner_id}</p>
    <p>${scan.data}</p>
  `;
  
  main.appendChild(row);
});*/

function findMopsNotToday(data) {
  const today = new Date();
  const todayString = today.toISOString().split('T')[0].replace(/-/g, '/');
  const todayMops = data.filter(item => item.data.startsWith(todayString)).map(item => item.mop_id);

  const result = data.filter(item => {
    const date = item.data.split('-')[0];
    return date !== todayString && !todayMops.includes(item.mop_id);
  });

  return result.map(item => item);
}

const missingMops = findMopsNotToday(data);
console.log(missingMops);

function manageLostItemSwitch() {
  const toggle = document.getElementById("toggle");
  const status = document.getElementById("status");

  toggle.addEventListener("change", () => {
    console.log("Toggle switched. Status:", toggle.checked ? "ON" : "OFF");
    status.textContent = toggle.checked ? "ON" : "OFF";

    main.classList.toggle('whos-missing');
    missingMops.forEach(el => {
      let thisel = document.querySelector(`[data-id="${el.mop_id}"]`);
      thisel.classList.add("not-me");
    });
  });
}

function makeThemGreen() {
  const today = new Date();
  const todayString = today.toISOString().split('T')[0].replace(/-/g, '/');
  const todayMops = data.filter(item => item.data.startsWith(todayString)).map(item => item);

  todayMops.forEach(element => {
    let thisel = document.querySelector(`[data-id="${element.mop_id}"]`);
    thisel.classList.add("green");
  });
}

document.addEventListener("DOMContentLoaded", () => {
  manageLostItemSwitch();
  makeThemGreen();
});
  </script>
</body>
</html>
